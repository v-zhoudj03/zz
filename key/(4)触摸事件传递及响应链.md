iOS触摸事件流程如下：

![iOS触摸事件流](/System/Volumes/Data/Users/zhoudengjie/文档/zz/pics/uitouchflow.png)



#### SpringBoard

> **SpringBoard** is the application launcher for the iPhone; it provides all application launching services, icon management, statusbar control, and everything else that's supposed to be filled in on this page at a later date.

SpringBoard是系统进程，可以理解为桌面系统（开机后，我们看到的界面），统一管理和分发系统的事件（触摸屏幕、按键、加速、传感器等）。

#### 1、系统响应

- 屏幕被触摸后，IOKit将触摸事件封装为IOHIDEvent（human interface device）对象，并通过mach port传递给SpringBoard进程。

>mach port是进程端口，各进程间通过它来通信。

- SpringBoard收到触摸事件，触发对应Mach Port的Source1回调`__IOHIDEventSystemClientQueueCallback()`。
  - 如果有App处于前台，则将触摸事件通过IPC传递给前台App进程
  - 如果没有App在前台，则触发SpringBoard主线程runLoop的Source0回调，之后便是App的启动（热启动、冷启动）

#### 2、App内部响应

- App进程通过mach port接收到SpringBoard的事件，主线程的runLoop被唤醒，触发Source1回调`__IOHIDEventSystemClientQueueCallback()`
- Source1回调内部触发Source0回调`__UIApplicationHandleEventQueue()`，将接收到的IOHIDEvent对象封装成UIEvent对象，App将正式开始对触摸事件的响应
- Source0回调将触摸事件添加到UIApplication事件队列，当触摸事件出队后UIApplication为触摸事件寻找最佳响应者，调用UIApplication的sendEvent:方法，将UIEvent传递给UIWindow(最顶层的window)
- 寻找到最佳响应者后，触摸事件在响应链中传递和响应

#### 3、寻找最佳响应者



参考：

- [iOS开发系列--触摸事件、手势识别、摇晃事件、耳机线控](ttps://www.cnblogs.com/kenshincui/p/3950646.html)
- [iOS触摸事件的流动](http://shellhue.github.io/2017/03/04/FlowOfUITouch/?FbmNv=5d89c1882bb68b92)
- [SpringBoard.app](http://iphonedevwiki.net/index.php/SpringBoard.app)
- [iOS中触摸事件传递和响应原理](https://www.jianshu.com/p/4aeaf3aa0c7e)